[toc]

```java
class Solution {
    public boolean sequenceReconstruction(int[] org, List<List<Integer>> seqs) {
        // 没有依赖关系
        if (seqs == null || org == null) throw new IllegalArgumentException("invalid param");

        // 图
        Map<Integer, Set<Integer>> graph = new HashMap<>();
        // 入度
        Map<Integer, Integer> degree = new HashMap<>();
        for (List<Integer> seq : seqs) {
            // 输入存在为空的情况
            if (seq.isEmpty()) continue;
            // 避免漏掉第一个点
            degree.putIfAbsent(seq.get(0), 0);
            int from = -1;
            for (int to : seq) {
                if (from != -1) {
                    graph.computeIfAbsent(from, k -> new HashSet<>());
                    // 防止重复加入
                    if (!graph.get(from).contains(to)) {
                        degree.put(to, degree.getOrDefault(to, 0) + 1);
                    }
                    graph.get(from).add(to);
                }
                from = to;
            }
        }
        // 初始化队列
        Queue<Integer> queue = new LinkedList<>();
        for (Map.Entry<Integer, Integer> entry : degree.entrySet()) {
            if (entry.getValue() == 0) queue.add(entry.getKey());
        }
        // org遍历索引
        int idx = 0;
        while (!queue.isEmpty()) {
            // 无法唯一决定依赖
            if (queue.size() != 1) return false;
            // 判断是否与org相符
            int cur = queue.poll();
            if (idx >= org.length || cur != org[idx++]) return false;

            if (graph.get(cur) == null) continue;
            for (int next : graph.get(cur)) {
                // cur出发的边入度减少
                degree.put(next, degree.get(next) - 1);
                // 入度为0，加入
                if (degree.get(next) == 0) queue.add(next);
            }
        }
        if (idx < org.length) return false;
        // 存在环
        for (int deg : degree.values()) {
            if (deg > 0) return false;
        }
        return true;
    }
}
```
