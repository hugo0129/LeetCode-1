[toc]

```java
class Solution {
    public List<List<String>> solveNQueens(int n) {
        List<List<String>> res = new LinkedList<>();
        if (n <= 0) return res;

        // 记录每一行存放的列
        int[] record = new int[n];
        // 皇后存在的列
        boolean[] cols = new boolean[n];
        // 皇后存在的两条对角线
        boolean[] a = new boolean[2 * n - 1], b = new boolean[2 * n - 1];
        // 从第一行开始分配回溯
        queue(0, record, cols, a, b, res);
        return res;
    }

    private void queue(int row, int[] record, boolean[] cols, boolean[] a, boolean[] b, List<List<String>> res) {
        int n = record.length;
        // 在row行col列放置皇后
        for (int col = 0; col < n; col++) {
            // 该位置已有皇后
            if (cols[col] || a[n - 1 - row + col] || b[row + col]) continue;
            // 标记占用
            cols[col] = a[n - 1 - row + col] = b[row + col] = true;
            record[row] = col;
            // 找到满足条件的一个解
            if (row == n - 1) {
                List<String> temp = new LinkedList<>();
                for (int i = 0; i < n; i++) {
                    temp.add(productString(n, record[i]));
                }
                res.add(temp);
            }
            // 继续下一行
            else {
                queue(row + 1, record, cols, a, b, res);
            }
            // 遍历结束，恢复状态
            cols[col] = a[n - 1 - row + col] = b[row + col] = false;
        }
    }

    private String productString(int num, int col) {
        char[] c = new char[num];
        for (int i = 0; i < num; i++) {
            c[i] = '.';
        }
        c[col] = 'Q';
        return new String(c);
    }
}
```
